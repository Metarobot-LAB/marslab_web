<style>
  /* People 확장형 메뉴 스타일 */
  .people-expand-wrapper {
    position: relative !important;
    display: inline-block !important;
    min-width: 100px !important;
  }

  .people-original-text {
    display: inline-block !important;
    transition: opacity 0.2s ease !important;
    white-space: nowrap !important;
  }

  .people-expanded-links {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.5rem !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity 0.2s ease !important;
    white-space: nowrap !important;
    pointer-events: none !important;
  }

  .people-expanded-links a {
    color: inherit !important;
    text-decoration: none !important;
    padding: 0 0.5rem !important;
    font-size: inherit !important;
    font-weight: inherit !important;
    transition: color 0.2s ease !important;
    pointer-events: auto !important;
  }

  .people-expanded-links a:hover {
    color: #3498db !important;
  }

  .people-expanded-links .divider {
    color: rgba(255, 255, 255, 0.5) !important;
    user-select: none !important;
    pointer-events: none !important;
  }

  /* 활성 상태 */
  .people-expand-wrapper.active .people-original-text {
    opacity: 0 !important;
    visibility: hidden !important;
    display: none !important;
  }

  .people-expand-wrapper.active .people-expanded-links {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    display: flex !important;
  }

  .has-people-expand {
    position: relative !important;
  }

  .masthead, 
  .masthead__inner-wrap, 
  .greedy-nav, 
  .greedy-nav .visible-links,
  .greedy-nav__list,
  .greedy-nav__list > li {
    overflow: visible !important;
  }

  @media (max-width: 768px) {
    .people-expand-wrapper {
      min-width: auto !important;
    }
    .people-expanded-links {
      position: relative !important;
      flex-direction: column !important;
      gap: 0.3rem !important;
      padding: 0.5rem 0 !important;
    }
    .people-expanded-links .divider {
      display: none !important;
    }
  }
</style>

<script>
(function() {
  'use strict';
  
  let peopleWrapper = null;
  let isInitialized = false;
  
  function initPeopleMenu() {
    if (isInitialized) return;
    
    // People 링크 찾기
    const allLinks = document.querySelectorAll('a');
    let peopleLink = null;
    let peopleItem = null;
    
    for (let link of allLinks) {
      const text = link.textContent.trim().toLowerCase();
      if (text === 'people') {
        const nav = link.closest('.greedy-nav') || link.closest('.masthead') || link.closest('nav');
        if (nav) {
          peopleLink = link;
          peopleItem = link.closest('li') || link.parentElement;
          break;
        }
      }
    }
    
    if (!peopleLink || !peopleItem) {
      return false;
    }
    
    // 이미 설정되어 있으면 스킵
    if (peopleItem.classList.contains('has-people-expand')) {
      peopleWrapper = peopleItem.querySelector('.people-expand-wrapper');
      if (peopleWrapper) {
        isInitialized = true;
        return true;
      }
    }
    
    try {
      const originalText = peopleLink.textContent.trim();
      
      // 래퍼 생성
      const wrapper = document.createElement('span');
      wrapper.className = 'people-expand-wrapper';
      
      // 원본 텍스트
      const originalSpan = document.createElement('span');
      originalSpan.className = 'people-original-text';
      originalSpan.textContent = originalText;
      
      // 확장 메뉴
      const expandedLinks = document.createElement('span');
      expandedLinks.className = 'people-expanded-links';
      
      const currentPath = window.location.pathname;
      const baseurl = currentPath.includes('/mars.github.io') ? '/mars.github.io' : '';
      
      expandedLinks.innerHTML = `
        <a href="${baseurl}/professor/">Professor</a>
        <span class="divider">|</span>
        <a href="${baseurl}/students/">Students</a>
      `;
      
      // DOM 구조 변경
      peopleLink.innerHTML = '';
      wrapper.appendChild(originalSpan);
      wrapper.appendChild(expandedLinks);
      peopleLink.appendChild(wrapper);
      
      peopleLink.href = 'javascript:void(0);';
      peopleLink.style.cursor = 'pointer';
      peopleItem.classList.add('has-people-expand');
      
      peopleWrapper = wrapper;
      
      // 클릭 이벤트 - 이벤트 위임 사용
      peopleItem.addEventListener('click', function(e) {
        // 확장 메뉴 내부 링크 클릭은 허용
        if (e.target.closest('.people-expanded-links') && e.target.tagName === 'A') {
          return true;
        }
        
        // People 텍스트나 래퍼 클릭 시 토글
        e.preventDefault();
        e.stopPropagation();
        
        const isActive = wrapper.classList.contains('active');
        wrapper.classList.toggle('active');
        
        console.log('People menu:', isActive ? '닫힘' : '열림');
      }, true);
      
      // 외부 클릭 시 닫기 (약간의 지연)
      setTimeout(function() {
        document.addEventListener('click', function(e) {
          if (!peopleItem.contains(e.target)) {
            wrapper.classList.remove('active');
          }
        }, true);
      }, 100);
      
      isInitialized = true;
      console.log('People menu: 초기화 완료');
      return true;
      
    } catch (e) {
      console.error('People menu: 오류', e);
      return false;
    }
  }
  
  // 여러 시점에서 초기화 시도
  function tryInit() {
    if (initPeopleMenu()) {
      return;
    }
    
    // MutationObserver로 DOM 변경 감지
    const observer = new MutationObserver(function() {
      if (initPeopleMenu()) {
        observer.disconnect();
      }
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
    
    setTimeout(function() {
      observer.disconnect();
    }, 5000);
  }
  
  // 즉시 시도
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', tryInit);
  } else {
    tryInit();
  }
  
  window.addEventListener('load', function() {
    setTimeout(tryInit, 100);
  });
  
  // 추가 재시도
  setTimeout(tryInit, 500);
  setTimeout(tryInit, 1000);
  setTimeout(tryInit, 2000);
})();
</script>
