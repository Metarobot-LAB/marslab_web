<style>
  /* People 확장형 메뉴 스타일 */
  .people-expand-wrapper {
    position: relative !important;
    display: inline-block !important;
    min-width: 100px !important; /* People 텍스트와 확장 메뉴가 같은 공간 차지 */
  }

  /* People 원본 텍스트 */
  .people-original-text {
    display: inline-block !important;
    transition: opacity 0.3s ease, visibility 0.3s ease !important;
    white-space: nowrap !important;
  }

  /* Professor | Students 확장 메뉴 */
  .people-expanded-links {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.5rem !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity 0.3s ease, visibility 0.3s ease !important;
    white-space: nowrap !important;
    pointer-events: none !important;
  }

  .people-expanded-links a {
    color: inherit !important;
    text-decoration: none !important;
    padding: 0 0.5rem !important;
    font-size: inherit !important;
    font-weight: inherit !important;
    transition: color 0.3s ease !important;
    pointer-events: auto !important;
  }

  .people-expanded-links a:hover {
    color: #3498db !important;
  }

  .people-expanded-links .divider {
    color: rgba(255, 255, 255, 0.5) !important;
    user-select: none !important;
    pointer-events: none !important;
  }

  /* 클릭 시 People 텍스트 숨기고 확장 메뉴 표시 */
  .people-expand-wrapper.active .people-original-text {
    opacity: 0 !important;
    visibility: hidden !important;
    display: none !important;
  }

  .people-expand-wrapper.active .people-expanded-links {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    display: flex !important;
  }
  
  /* 디버깅: active 클래스 확인용 */
  .people-expand-wrapper.active {
    background-color: transparent !important;
  }

  /* li 요소에 클래스 추가 시 스타일 적용 */
  .has-people-expand {
    position: relative !important;
  }

  /* 다른 메뉴와 겹치지 않도록 z-index 설정 */
  .has-people-expand {
    z-index: 10 !important;
  }

  /* [필수] 상단바가 확장 메뉴를 가리지 않도록 모든 부모 요소의 overflow 해제 */
  .masthead, 
  .masthead__inner-wrap, 
  .greedy-nav, 
  .greedy-nav .visible-links,
  .greedy-nav__list,
  .greedy-nav__list > li {
    overflow: visible !important;
  }

  /* 모바일 반응형 */
  @media (max-width: 768px) {
    .people-expand-wrapper {
      min-width: auto !important;
    }

    .people-expanded-links {
      position: relative !important;
      flex-direction: column !important;
      gap: 0.3rem !important;
      padding: 0.5rem 0 !important;
    }

    .people-expanded-links .divider {
      display: none !important;
    }
  }
</style>

<script>
(function() {
  'use strict';
  
  let setupComplete = false;
  let setupAttempts = 0;
  const MAX_ATTEMPTS = 10;
  
  function setupPeopleExpand() {
    if (setupComplete) {
      return true;
    }
    
    setupAttempts++;
    if (setupAttempts > MAX_ATTEMPTS) {
      console.warn('People expand: 최대 시도 횟수 초과');
      return false;
    }
    
    // 이미 설정되어 있는지 확인
    if (document.querySelector('.people-expand-wrapper')) {
      setupComplete = true;
      return true;
    }
    
    // 'People' 텍스트를 가진 링크 찾기
    const selectors = [
      '.greedy-nav a',
      '.greedy-nav__list a',
      '.visible-links a',
      '.masthead a',
      'nav a',
      'header nav a'
    ];
    
    let peopleLink = null;
    let peopleItem = null;
    
    for (const selector of selectors) {
      try {
        const links = document.querySelectorAll(selector);
        for (let link of links) {
          const text = link.textContent.trim().toLowerCase();
          if (text === 'people') {
            if (link.closest('.greedy-nav') || link.closest('.masthead') || link.closest('nav')) {
              peopleLink = link;
              peopleItem = link.closest('li');
              if (!peopleItem) {
                peopleItem = link.parentElement;
              }
              break;
            }
          }
        }
        if (peopleLink && peopleItem) break;
      } catch (e) {
        console.warn('People expand selector error:', selector, e);
      }
    }
    
    if (!peopleLink || !peopleItem) {
      if (setupAttempts === 1) {
        console.log('People expand: 링크를 찾는 중... (재시도 가능)');
      }
      return false;
    }
    
    // 이미 설정되어 있으면 스킵
    if (peopleItem.classList.contains('has-people-expand')) {
      setupComplete = true;
      return true;
    }
    
    try {
      // 원본 텍스트 저장
      const originalText = peopleLink.textContent.trim();
      
      // People 링크를 래퍼로 감싸기
      const wrapper = document.createElement('span');
      wrapper.className = 'people-expand-wrapper';
      
      // 원본 텍스트 요소
      const originalTextSpan = document.createElement('span');
      originalTextSpan.className = 'people-original-text';
      originalTextSpan.textContent = originalText;
      
      // 확장 메뉴 요소
      const expandedLinks = document.createElement('span');
      expandedLinks.className = 'people-expanded-links';
      
      // baseurl 동적 감지
      const currentPath = window.location.pathname;
      let baseurl = '';
      if (currentPath.includes('/mars.github.io')) {
        baseurl = '/mars.github.io';
      }
      
      expandedLinks.innerHTML = `
        <a href="${baseurl}/professor/">Professor</a>
        <span class="divider">|</span>
        <a href="${baseurl}/students/">Students</a>
      `;
      
      // 링크 내용 교체
      peopleLink.innerHTML = '';
      wrapper.appendChild(originalTextSpan);
      wrapper.appendChild(expandedLinks);
      peopleLink.appendChild(wrapper);
      
      // 링크 기능 비활성화
      peopleLink.href = 'javascript:void(0);';
      peopleLink.style.cursor = 'pointer';
      
      // li에 클래스 추가
      peopleItem.classList.add('has-people-expand');
      
      // 토글 함수 정의
      function togglePeopleMenu(e) {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        
        // 확장 메뉴 내부 링크 클릭은 허용 (링크로 이동)
        if (e && e.target && e.target.tagName === 'A' && e.target.closest('.people-expanded-links')) {
          console.log('People expand: 링크 클릭됨, 이동 허용');
          return true;
        }
        
        // 토글
        const isActive = wrapper.classList.contains('active');
        if (isActive) {
          wrapper.classList.remove('active');
          console.log('People expand: 닫힘');
        } else {
          wrapper.classList.add('active');
          console.log('People expand: 열림');
        }
      }
      
      // 클릭 이벤트 바인딩 (여러 방법으로 시도)
      // 1. peopleLink에 직접 바인딩
      peopleLink.addEventListener('click', togglePeopleMenu, false);
      
      // 2. wrapper에도 바인딩
      wrapper.addEventListener('click', function(e) {
        // 확장 메뉴 내부 링크는 제외
        if (e.target.closest('.people-expanded-links') && e.target.tagName === 'A') {
          return true;
        }
        togglePeopleMenu(e);
      }, false);
      
      // 3. 원본 텍스트에도 바인딩
      originalTextSpan.addEventListener('click', togglePeopleMenu, false);
      originalTextSpan.style.cursor = 'pointer';
      
      // 외부 클릭시 닫기
      document.addEventListener('click', function(e) {
        // 확장 메뉴 내부 링크 클릭은 무시 (링크로 이동 허용)
        if (e.target.closest('.people-expanded-links') && e.target.tagName === 'A') {
          return;
        }
        
        // People 영역 외부 클릭 시 닫기
        if (!peopleItem.contains(e.target)) {
          wrapper.classList.remove('active');
        }
      }, false);
      
      setupComplete = true;
      console.log('People expand: 성공적으로 설정됨');
      return true;
      
    } catch (e) {
      console.error('People expand: 설정 중 오류 발생', e);
      return false;
    }
  }
  
  // 초기화 함수
  function initPeopleExpand() {
    if (setupPeopleExpand()) {
      return;
    }
    
    // MutationObserver로 DOM 변경 감지
    const observer = new MutationObserver(function(mutations) {
      if (setupPeopleExpand()) {
        observer.disconnect();
      }
    });
    
    observer.observe(document.body, { 
      childList: true, 
      subtree: true 
    });
    
    // 일정 시간 후 observer 해제
    setTimeout(function() {
      observer.disconnect();
    }, 10000);
  }
  
  // 여러 시점에서 실행
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initPeopleExpand);
  } else {
    initPeopleExpand();
  }
  
  window.addEventListener('load', function() {
    setTimeout(initPeopleExpand, 100);
  });
  
  // 추가 재시도
  setTimeout(initPeopleExpand, 500);
  setTimeout(initPeopleExpand, 1000);
  setTimeout(initPeopleExpand, 2000);
})();
</script>
